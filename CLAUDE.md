# CLAUDE.md - Istruzioni Complete per Claude Code
## Progetto: Vitaeology - Leadership Development Platform

**Versione:** 2.7
**Ultimo aggiornamento:** 21 Gennaio 2026
**Owner:** Fernando Marongiu

---

## CONTESTO PROGETTO

Vitaeology √® una **piattaforma SaaS completa** per lo sviluppo della leadership destinata a imprenditori italiani (35-55 anni).

### Stack Tecnologico
| Tecnologia | Versione | Uso |
|------------|----------|-----|
| Next.js | 14.x | App Router, SSR |
| TypeScript | 5.x | Tipizzazione strict |
| Supabase | - | PostgreSQL + Auth + RLS |
| Tailwind CSS | 3.x | Styling |
| Stripe | - | Pagamenti subscription + one-time |
| Anthropic Claude | - | AI Coach |
| OpenAI | - | Embeddings RAG |
| Resend | - | Email automation |
| Vercel | - | Hosting + Cron |

### Integrazioni Attive
- **ANTHROPIC_API_KEY** ‚Üí AI Coach Fernando
- **OPENAI_API_KEY** ‚Üí Embeddings per RAG (3 libri)
- **STRIPE_SECRET_KEY** ‚Üí Pagamenti
- **RESEND_API_KEY** ‚Üí Email challenge
- **SUPABASE** ‚Üí Database + Auth

---

## DATI BIOGRAFICI FERNANDO MARONGIU (OBBLIGATORIO)

**‚ö†Ô∏è SEMPRE verificare le et√† quando si scrive contenuto su Fernando!**

### Riferimento Rapido
| Dato | Valore |
|------|--------|
| **Anno di nascita** | 1957 |
| **Et√† attuale (2026)** | 68-69 anni |

### Calcolo Et√† per Anno
```
Et√† = Anno evento - 1957
```

### Eventi Chiave nelle Storie
| Anno | Et√† Fernando | Evento/Storia |
|------|--------------|---------------|
| 1973 | **16 anni** | Inizio "anni perduti" (Microfelicit√†) |
| 1982 | **25 anni** | Fine "anni perduti" |
| 1989 | **32 anni** | Cabina telefonica #1: chiedere permesso a manager (Leadership) |
| 1992 | **35 anni** | Covey "7 Habits" pubblicato in italiano |
| 1993 | **36 anni** | Cabina telefonica #2: tessera ristoranti "TheFork" (Ostacoli) |
| Primi 2000 | ~45 anni | Fallimento energie rinnovabili |
| 2007 | **50 anni** | Ingresso settore oro/gioielleria |
| 2024 | **67 anni** | Fondazione Vitaeology |
| 2026 | **68-69 anni** | Oggi |

### Due Episodi Cabina Telefonica (NON confondere!)
1. **1989 (Leadership)**: Parlava con un manager, chiedeva "il permesso" di essere riconosciuto come persona lungimirante. Sensazione di essere relegato a comprimario.
2. **1993 (Ostacoli)**: Progetto tessera ristoranti (precursore TheFork). Settimane a chiamare ristoranti da cabina telefonica.

### Regola
```
‚ùå MAI inventare et√† senza calcolare: Anno - 1957
‚úÖ SEMPRE verificare: "Nel [ANNO] avevo [ANNO - 1957] anni"
```

---

## PRINCIPI FONDAMENTALI (OBBLIGATORI)

### 0. Framework dei 4 Prodotti (Fondamento)

Ogni sistema di produzione genera **4 prodotti fondamentali**, ciascuno governato da **3 fattori**:

#### I 4 Prodotti

| # | Prodotto | Definizione | In Vitaeology |
|---|----------|-------------|---------------|
| **P1** | L'istituzione di ci√≤ che produce | Il sistema/macchina che genera | Piattaforma (Challenge, Assessment, Esercizi) |
| **P2** | Il prodotto generato | L'output creato | Trasformazione utente (risultati, completamenti, consapevolezza) |
| **P3** | La riparazione di ci√≤ che produce | Manutenzione del sistema | Bug fix, UX improvements, ottimizzazioni |
| **P4** | La correzione del prodotto generato | Correzione dell'output | **AI Coach Fernando** (supporto on-demand) |

#### I 3 Fattori (per ogni prodotto)

| Fattore | Significato | Domanda Guida |
|---------|-------------|---------------|
| **Quantit√†** | Ammontare | "Quanto ne produciamo?" |
| **Qualit√†** | Grado di perfezione | "Quanto √® ben fatto?" |
| **Viability** | Longevit√†, utilit√†, desiderabilit√† | "Quanto dura e serve?" |

**Totale: 4 Prodotti √ó 3 Fattori = 12 Fattori di Produzione**

#### Regola Critica
```
NON confondere i 4 prodotti tra loro.
Ogni prodotto ha il suo contesto e momento.
```

#### Applicazione a Vitaeology

```
P1 (Sistema)     ‚Üí Costruisce i funnel e le funzionalit√†
P2 (Output)      ‚Üí Consegnato all'utente ai punti STOP
P3 (Manutenzione)‚Üí Migliora il sistema nel tempo
P4 (Correzione)  ‚Üí Disponibile ON-DEMAND, non imposto
```

**Errore tipico:** Trattare P4 (AI Coach) come P2 (output da consumare), proponendolo ai punti STOP dove l'utente deve ricevere il suo output, non una correzione.

**Soluzione:** AI Coach (P4) vive sulla Dashboard, disponibile quando l'utente SCEGLIE di correggere/migliorare il suo percorso.

---

### 1. Principio Validante: AVERE vs ESSERE/FARE (ESSENZIALE)

**ESSERE, FARE, AVERE sono condizioni di esistenza.**

#### La Differenza Fondamentale: LIBERT√Ä

| Condizione | Il soggetto... | Risultato |
|------------|----------------|-----------|
| **ESSERE/FARE** | √à alla merc√© del giudizio | Invalidazione o valutazione |
| **AVERE/NON AVERE** | Ha una scelta | **LIBERT√Ä** |

**AVERE e NON AVERE sono due possibilit√† che implicano un livello di libert√†.**
Se posso AVERE o anche NON AVERE una cosa o una scelta ‚Äî questa √® una condizione di LIBERT√Ä.

#### Perch√© ESSERE e FARE sono problematici
ESSERE e FARE mettono il soggetto **alla completa "merc√©"** di chi parla ‚Äî sono per lo pi√π **invalidanti** (giudicano negativamente) o **valutanti** (giudicano, anche se positivamente). Il soggetto non ha scelta: √à o NON √à, FA o NON FA.

#### Perch√© AVERE implica libert√†
AVERE/NON AVERE riconoscono che il soggetto **pu√≤ scegliere**. "Hai questa capacit√†" significa anche "puoi scegliere di usarla o no". La libert√† sta nella possibilit√† stessa.

#### Applicazione Pratica
```
‚úÖ Enfatizzare AVERE: "Hai gi√†...", "Possiedi...", "Puoi scegliere di..."
   ‚Üí Riconosce possesso E libert√† di scelta

‚ùå Evitare deficit forzati: "Ti manca...", "Non hai..." (come sentenza)
   ‚Üí Rimuove la libert√†, impone un giudizio

‚ùå Evitare ESSERE: "Sei/Non sei..."
   ‚Üí Giudizio identitario, nessuna via d'uscita

‚ùå Evitare FARE: "Fai/Non fai..."
   ‚Üí Giudizio comportamentale, alla merc√© del giudicante
```

#### Esempi Pratici
| ‚ùå Sbagliato (giudizio/deficit) | ‚úÖ Corretto (riconoscimento/libert√†) |
|--------------------------------|--------------------------------------|
| "Non sei un vero leader" | "Hai capacit√† di leadership ‚Äî puoi scegliere come usarle" |
| "Ti manca la visione" | "Hai una visione ‚Äî puoi ampliarla se vuoi" |
| "Devi migliorare" | "Hai risorse che puoi attivare" |
| "Sei bravo" | "Questo √® qualcosa che hai" |
| "Non fai abbastanza" | "Hai pi√π opzioni di quelle che stai usando" |

**L'utente POSSIEDE GI√Ä tutte le capacit√† di leadership. Ha la LIBERT√Ä di riconoscerle e usarle.**

---

### 2. User Agency
- L'utente √® **AGENTE attivo**, non paziente passivo
- Mai prescrizioni dirette ("devi fare X")
- Sempre domande e facilitazione

### 3. AI Coach = FERNANDO (mai Marco)
```
‚úÖ "Sono Fernando, il tuo AI Coach"
‚ùå "Sono Marco" (ERRORE CRITICO)
```

### 4. Principio STOP ‚Üí START (Customer Journey)

Il Customer Journey segue cicli **START ‚Üí CHANGE ‚Üí STOP**:
- **START**: L'utente inizia un'azione (es. inizia assessment)
- **CHANGE**: L'utente √® nel processo (es. risponde alle domande)
- **STOP**: L'utente completa l'azione (es. vede i risultati)

#### Regola Fondamentale
```
Ogni STOP deve avere UNA CTA chiara che motiva al S√å verso il prossimo START.
NO opzioni multiple che creano incertezza decisionale.
```

#### AI Coach Fernando: Dove S√å e Dove NO

| Contesto | AI Coach | Motivo |
|----------|----------|--------|
| **Dashboard** | ‚úÖ S√å | Hub neutro, l'utente sceglie |
| **Assessment Results** | ‚ùå NO | CTA chiara: "Inizia Esercizio" |
| **Challenge Day 1-7** | ‚ùå NO | Focus sul contenuto strutturato |
| **Challenge Complete** | ‚ùå NO | CTA chiara: "Fai Assessment" |
| **Subscription Success** | ‚ùå NO | CTA chiara: "Vai alla Dashboard" |
| **Exercise Complete** | ‚ùå NO | CTA chiara: "Prossimo Esercizio" |
| **Email transazionali** | ‚ùå NO | CTA diretta all'azione |

#### Perch√© NO ai punti STOP?
1. **AI Coach √® conversazione aperta** ‚Üí Gli STOP richiedono direzione precisa
2. **Crea attrito decisionale** ‚Üí "Clicco esercizi O parlo con Fernando?"
3. **Lo STOP deve motivare UN solo S√å** ‚Üí Non dare alternative ambigue

#### Esempio Corretto
```
STOP: Assessment Results
  ‚ùå "Parla con Fernando dei tuoi risultati" (ambiguo)
  ‚úÖ "Inizia l'Esercizio per la tua Area di Crescita" (azione chiara)
```

---

### 5. Framework Verifica Comprensione (FORMAZIONE)

> **Principio:** Se l'esame finale verifica comprensione a 3 livelli, TUTTO il percorso formativo deve preparare a quei livelli fin dall'inizio.

#### Le 3 Barriere alla Comprensione (da prevenire SEMPRE)

| Barriera | Significato | Come Prevenire |
|----------|-------------|----------------|
| **Parola mal compresa** | L'utente non capisce un termine | Spiegare OGNI termine non comune immediatamente |
| **Mancanza di concretezza** | Concetti astratti senza esempi | SEMPRE esempi dalla vita reale dell'imprenditore |
| **Gradiente saltato** | Passaggi logici mancanti | Progressione graduale, mai saltare step |

#### I 3 Livelli di Comprensione (da costruire in OGNI contenuto)

| Livello | Cosa Insegna | Domanda di Verifica | Applicazione |
|---------|--------------|---------------------|--------------|
| **DATI STABILI** | Il "COSA" - definizioni, regole, principi | "Cos'√® [X]? Definiscilo con parole tue" | Ogni esercizio deve definire i concetti chiave |
| **DOINGNESS** | Il "COME" - passi concreti, procedura | "Come si fa [X]? Descrivi i passi" | Ogni esercizio deve avere istruzioni step-by-step |
| **TEORIA** | Il "PERCH√â" - logica sottostante, scopo | "Perch√© funziona [X]?" | Ogni esercizio deve spiegare il razionale |

#### Applicazione Pratica

```
‚ö†Ô∏è REGOLA: Ogni contenuto formativo (esercizio, challenge, assessment) deve:

1. PREVENIRE le 3 barriere:
   - Glossario/spiegazione termini integrata
   - Esempi concreti per ogni concetto
   - Progressione graduale verificabile

2. COSTRUIRE i 3 livelli:
   - Definire COSA si sta imparando (Dati Stabili)
   - Mostrare COME si applica (Doingness)
   - Spiegare PERCH√â funziona (Teoria)

3. VERIFICARE la comprensione:
   - Domande di riflessione che testano i 3 livelli
   - Deliverable che dimostrano applicazione pratica
```

#### Checklist per Ogni Contenuto Formativo

- [ ] **Termini:** Tutti i termini non comuni sono spiegati?
- [ ] **Esempi:** Ci sono esempi concreti dalla vita imprenditoriale?
- [ ] **Gradualit√†:** La progressione √® logica e senza salti?
- [ ] **Dati Stabili:** L'utente sapr√† definire il concetto?
- [ ] **Doingness:** L'utente sapr√† applicarlo passo per passo?
- [ ] **Teoria:** L'utente capir√† perch√© funziona?

---

### 6. Struttura Esercizio Vincolante (OBBLIGATORIA)

> **‚ö†Ô∏è REGOLA INDEROGABILE:** Ogni esercizio DEVE seguire questa struttura. Esercizi che non rispettano questo schema NON possono essere pubblicati.

#### Schema Completo Esercizio

```typescript
interface ExerciseComplete {
  // === IDENTIFICAZIONE ===
  id: string;
  week_number: number;              // 1-52
  title: string;                    // Titolo evocativo
  subtitle: string;                 // Sottotitolo descrittivo
  characteristic_slug: string;      // Collegamento a caratteristica

  // === CATEGORIZZAZIONE ===
  pillar: 'Vision' | 'Action' | 'Relations' | 'Adaptation';
  exercise_type: 'riconoscimento' | 'espansione' | 'sfida' | 'integrazione';
  difficulty_level: 'base' | 'intermedio' | 'avanzato';
  quarter: 'Q1' | 'Q2' | 'Q3' | 'Q4';
  estimated_time_minutes: number;

  // === PREVENZIONE 3 BARRIERE ===
  glossary: {                       // BARRIERA 1: Parole mal comprese
    term: string;
    definition: string;
    example: string;
  }[];

  concrete_examples: {              // BARRIERA 2: Mancanza concretezza
    situation: string;              // Situazione riconoscibile
    application: string;            // Come si applica
  }[];

  prerequisites: string[];          // BARRIERA 3: Gradiente saltato
                                    // Lista di cosa l'utente deve gi√† sapere

  // === LIVELLO 1: DATI STABILI (COSA) ===
  key_concepts: {
    concept: string;                // Il concetto
    definition: string;             // Definizione chiara
    why_important: string;          // Perch√© √® importante
  }[];

  // === LIVELLO 2: DOINGNESS (COME) ===
  intro_validante: string;          // Intro che PRESUME la capacit√† esistente

  phase_1_recognition: {            // Fase ESSERE
    title: string;                  // "Riconoscimento - Chi Eri"
    being_focus: string;            // Identit√† quando operi cos√¨
    prompt: string;                 // "Quando hai gi√† operato con [X]?"
    instructions: string[];         // Passi concreti
  };

  phase_2_pattern: {                // Fase FARE
    title: string;                  // "Pattern - Cosa Facevi"
    doing_focus: string;            // Comportamento caratteristico
    prompt: string;                 // "Cosa caratterizzava quei momenti?"
    guiding_questions: string[];    // Domande guida
  };

  phase_3_expansion: {              // Fase AVERE
    title: string;                  // "Espansione - Come Ricreare"
    having_focus: string;           // Risultato ottenibile
    prompt: string;                 // "Come portare quel pattern dove non lo usi?"
    action_steps: string[];         // Passi azione concreti
  };

  deliverable: string;              // Output tangibile richiesto

  // === LIVELLO 3: TEORIA (PERCH√â) ===
  why_it_works: {
    principle: string;              // Il principio sottostante
    explanation: string;            // Spiegazione del perch√© funziona
    scientific_basis?: string;      // Base scientifica (se applicabile)
  };

  // === VERIFICA COMPRENSIONE ===
  reflection_prompts: {
    level: 'dati_stabili' | 'doingness' | 'teoria';
    question: string;
  }[];

  // === SUPPORTO ===
  failure_response: string;         // Risposta validante se non completa
  ai_coach_hints: string[];         // Suggerimenti per AI Coach Fernando
}
```

#### Esempio Esercizio Conforme

```json
{
  "week_number": 1,
  "title": "La Consapevolezza che Gi√† Operi",
  "subtitle": "Riconosci dove gi√† usi l'autoconsapevolezza",
  "characteristic_slug": "autoconsapevolezza",
  "pillar": "Vision",
  "exercise_type": "riconoscimento",
  "difficulty_level": "base",
  "quarter": "Q1",
  "estimated_time_minutes": 25,

  "glossary": [
    {
      "term": "Autoconsapevolezza",
      "definition": "La capacit√† di osservare te stesso mentre agisci, come se ti guardassi dall'esterno",
      "example": "Quando guidi e ti accorgi di star pensando ad altro - quel momento di 'accorgerti' √à autoconsapevolezza"
    }
  ],

  "concrete_examples": [
    {
      "situation": "Sei in una riunione tesa e noti che ti stai irrigidendo",
      "application": "Il fatto stesso di NOTARE che ti stai irrigidendo √® autoconsapevolezza in azione"
    }
  ],

  "prerequisites": [],

  "key_concepts": [
    {
      "concept": "Autoconsapevolezza",
      "definition": "Vedere te stesso mentre operi",
      "why_important": "Senza vedere cosa fai, non puoi scegliere di cambiarlo"
    }
  ],

  "intro_validante": "Probabilmente prendi decisioni importanti ogni settimana senza chiamarle 'leadership'. Questo esercizio ti aiuta a RICONOSCERE la consapevolezza che gi√† operi naturalmente - non a sviluppare qualcosa che ti manca.",

  "phase_1_recognition": {
    "title": "Riconoscimento - Chi Eri",
    "being_focus": "L'identit√† di chi osserva se stesso",
    "prompt": "Ricorda 3 decisioni importanti dell'ultimo anno. Per ognuna: come ti sentivi DURANTE?",
    "instructions": [
      "Trova un momento tranquillo di 10 minuti",
      "Scrivi 3 decisioni importanti dell'ultimo anno",
      "Per ogni decisione, nota l'emozione che provavi MENTRE decidevi",
      "Non giudicare se erano 'giuste' - osserva solo l'esperienza"
    ]
  },

  "phase_2_pattern": {
    "title": "Pattern - Cosa Facevi",
    "doing_focus": "Le condizioni che favorivano la consapevolezza",
    "prompt": "Cerca il pattern comune tra quei momenti",
    "guiding_questions": [
      "Eri solo o con altri?",
      "Era mattina, pomeriggio o sera?",
      "Eri in fretta o avevi calma?",
      "Dove ti trovavi fisicamente?"
    ]
  },

  "phase_3_expansion": {
    "title": "Espansione - Come Ricreare",
    "having_focus": "La capacit√† di ricreare quelle condizioni intenzionalmente",
    "prompt": "Come puoi ricreare quelle condizioni quando serve?",
    "action_steps": [
      "Scegli UNA condizione che puoi replicare facilmente",
      "Identifica UNA situazione della prossima settimana dove la userai",
      "Scrivi un promemoria per ricordarti"
    ]
  },

  "deliverable": "Documento con: 3 decisioni + emozioni durante + pattern comune + 1 condizione da replicare + 1 situazione dove la userai",

  "why_it_works": {
    "principle": "L'attenzione crea scelta",
    "explanation": "Quando noti cosa stai facendo, puoi scegliere se continuare o cambiare. Senza notare, reagisci automaticamente. L'autoconsapevolezza trasforma reazioni automatiche in scelte consapevoli.",
    "scientific_basis": "Metacognizione - la capacit√† del cervello di osservare i propri processi mentali"
  },

  "reflection_prompts": [
    {
      "level": "dati_stabili",
      "question": "Con parole tue, cos'√® l'autoconsapevolezza?"
    },
    {
      "level": "doingness",
      "question": "Descrivi i passi che hai seguito per identificare il tuo pattern"
    },
    {
      "level": "teoria",
      "question": "Perch√© notare cosa fai ti d√† pi√π potere di scelta?"
    }
  ],

  "failure_response": "Forse stai cercando decisioni 'grandi'. Prova con decisioni pi√π piccole ma comunque significative per te - anche scegliere di NON decidere √® una decisione.",

  "ai_coach_hints": [
    "Se l'utente fatica a trovare decisioni, suggerisci: assunzioni, licenziamenti, investimenti, cambio fornitori",
    "Se l'utente non trova pattern, aiutalo a cercare: luogo fisico, ora del giorno, stato emotivo pre-decisione"
  ]
}
```

#### Validazione Obbligatoria

Prima di pubblicare un esercizio, verifica:

```
‚úÖ PREVENZIONE BARRIERE
‚ñ° Glossary: Tutti i termini non comuni hanno definizione + esempio?
‚ñ° Concrete examples: Ci sono almeno 2 situazioni riconoscibili?
‚ñ° Prerequisites: √à chiaro cosa l'utente deve gi√† sapere?

‚úÖ LIVELLO 1 - DATI STABILI
‚ñ° Key concepts: Ogni concetto ha definizione + why_important?
‚ñ° L'utente sapr√† rispondere a "Cos'√® [X]?"

‚úÖ LIVELLO 2 - DOINGNESS
‚ñ° Phase 1-2-3: Tutte e 3 le fasi sono complete?
‚ñ° Instructions/steps: Sono concreti e sequenziali?
‚ñ° L'utente sapr√† rispondere a "Come si fa [X]?"

‚úÖ LIVELLO 3 - TEORIA
‚ñ° Why it works: C'√® principle + explanation?
‚ñ° L'utente sapr√† rispondere a "Perch√© funziona [X]?"

‚úÖ VERIFICA COMPRENSIONE
‚ñ° Reflection prompts: Ci sono domande per tutti e 3 i livelli?

‚úÖ LINGUAGGIO VALIDANTE
‚ñ° Intro presume la capacit√† esistente (mai deficit)?
‚ñ° Failure response √® validante (non giudicante)?
```

---

## STRUTTURA PROGETTO COMPLETA

### Pagine (35+)

```
src/app/
‚îú‚îÄ‚îÄ page.tsx                     # Homepage
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ login/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ signup/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ forgot-password/page.tsx
‚îÇ   ‚îî‚îÄ‚îÄ reset-password/page.tsx
‚îÇ
‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx               # Layout con sidebar
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                 # Dashboard principale
‚îÇ
‚îú‚îÄ‚îÄ assessment/
‚îÇ   ‚îú‚îÄ‚îÄ leadership/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # 72 domande Leadership
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ results/page.tsx     # Risultati radar chart
‚îÇ   ‚îú‚îÄ‚îÄ risolutore/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # 48 domande Risolutore
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ results/page.tsx     # Risultati
‚îÇ   ‚îî‚îÄ‚îÄ microfelicita/
‚îÇ       ‚îú‚îÄ‚îÄ page.tsx             # 47 domande Microfelicit√†
‚îÇ       ‚îî‚îÄ‚îÄ results/page.tsx     # Risultati
‚îÇ
‚îú‚îÄ‚îÄ exercises/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # Lista 52 esercizi
‚îÇ   ‚îî‚îÄ‚îÄ [exerciseId]/page.tsx    # Dettaglio esercizio
‚îÇ
‚îú‚îÄ‚îÄ challenge/                   # FUNNEL 7 GIORNI
‚îÇ   ‚îú‚îÄ‚îÄ leadership/page.tsx      # Landing A/B (amber)
‚îÇ   ‚îú‚îÄ‚îÄ ostacoli/page.tsx        # Landing A/B (emerald)
‚îÇ   ‚îú‚îÄ‚îÄ microfelicita/page.tsx   # Landing A/B (violet)
‚îÇ   ‚îî‚îÄ‚îÄ [type]/
‚îÇ       ‚îú‚îÄ‚îÄ day/[day]/page.tsx   # Contenuto giorno 1-7
‚îÇ       ‚îî‚îÄ‚îÄ complete/page.tsx    # Completamento
‚îÇ
‚îú‚îÄ‚îÄ libro/                       # SALES FUNNEL LIBRI
‚îÇ   ‚îî‚îÄ‚îÄ [slug]/
‚îÇ       ‚îú‚îÄ‚îÄ page.tsx             # Landing libro (leadership|risolutore|microfelicita)
‚îÇ       ‚îú‚îÄ‚îÄ AcquistaButton.tsx   # Bottone checkout
‚îÇ       ‚îî‚îÄ‚îÄ grazie/page.tsx      # Thank you post-acquisto
‚îÇ
‚îú‚îÄ‚îÄ admin/                       # ADMIN PANEL (9 pagine)
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ users/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ analytics/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ai-coach/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ api-costs/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ performance/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ quality-audit/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ feedback-patterns/page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ corrections/page.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ab-testing/page.tsx
‚îÇ
‚îú‚îÄ‚îÄ profile/page.tsx
‚îú‚îÄ‚îÄ progress/page.tsx
‚îú‚îÄ‚îÄ results/page.tsx
‚îú‚îÄ‚îÄ pricing/page.tsx
‚îú‚îÄ‚îÄ subscription/page.tsx
‚îú‚îÄ‚îÄ contact/page.tsx
‚îú‚îÄ‚îÄ terms/page.tsx
‚îî‚îÄ‚îÄ privacy/page.tsx
```

### API Endpoints (38+)

```
src/app/api/
‚îú‚îÄ‚îÄ ai-coach/
‚îÇ   ‚îú‚îÄ‚îÄ route.ts                 # POST - Chat principale Claude
‚îÇ   ‚îú‚îÄ‚îÄ conversations/route.ts   # GET - Lista conversazioni
‚îÇ   ‚îú‚îÄ‚îÄ feedback/route.ts        # POST - Feedback messaggio
‚îÇ   ‚îú‚îÄ‚îÄ edit/route.ts            # POST - Modifica messaggio
‚îÇ   ‚îú‚îÄ‚îÄ reformulate/route.ts     # POST - Riformulazione
‚îÇ   ‚îú‚îÄ‚îÄ history/route.ts         # GET - Storico paginato
‚îÇ   ‚îú‚îÄ‚îÄ export/route.ts          # POST - Export PDF/JSON
‚îÇ   ‚îú‚îÄ‚îÄ signals/route.ts         # POST - Segnali impliciti
‚îÇ   ‚îî‚îÄ‚îÄ cron/
‚îÇ       ‚îú‚îÄ‚îÄ daily-metrics/route.ts
‚îÇ       ‚îî‚îÄ‚îÄ weekly-report/route.ts
‚îÇ
‚îú‚îÄ‚îÄ assessment/
‚îÇ   ‚îú‚îÄ‚îÄ questions/route.ts       # GET - 72 domande
‚îÇ   ‚îú‚îÄ‚îÄ session/route.ts         # POST - Crea/recupera sessione
‚îÇ   ‚îú‚îÄ‚îÄ answer/route.ts          # POST - Salva risposta
‚îÇ   ‚îú‚îÄ‚îÄ complete/route.ts        # POST - Completa assessment
‚îÇ   ‚îî‚îÄ‚îÄ results/[id]/route.ts    # GET - Risultati
‚îÇ
‚îú‚îÄ‚îÄ stripe/
‚îÇ   ‚îú‚îÄ‚îÄ checkout/route.ts        # POST - Checkout subscription
‚îÇ   ‚îú‚îÄ‚îÄ portal/route.ts          # POST - Customer portal
‚îÇ   ‚îî‚îÄ‚îÄ webhook/route.ts         # POST - Webhook Stripe
‚îÇ
‚îú‚îÄ‚îÄ challenge/
‚îÇ   ‚îú‚îÄ‚îÄ subscribe/route.ts       # POST - Iscrizione + welcome email
‚îÇ   ‚îú‚îÄ‚îÄ complete-day/route.ts    # POST - Completa giorno
‚îÇ   ‚îî‚îÄ‚îÄ check-unlock/route.ts    # POST - Verifica sblocco
‚îÇ
‚îú‚îÄ‚îÄ libro/
‚îÇ   ‚îî‚îÄ‚îÄ checkout/route.ts        # POST - Checkout libro singolo
‚îÇ
‚îú‚îÄ‚îÄ recommendations/route.ts     # GET - Esercizi raccomandati
‚îÇ
‚îú‚îÄ‚îÄ cron/
‚îÇ   ‚îî‚îÄ‚îÄ send-challenge-emails/route.ts  # Cron giornaliero
‚îÇ
‚îî‚îÄ‚îÄ admin/
    ‚îú‚îÄ‚îÄ users/route.ts
    ‚îú‚îÄ‚îÄ analytics/route.ts
    ‚îî‚îÄ‚îÄ ai-coach/dashboard/route.ts
```

### Componenti (24+)

```
src/components/
‚îú‚îÄ‚îÄ ai-coach/
‚îÇ   ‚îú‚îÄ‚îÄ ChatWidget.tsx           # Widget chat principale
‚îÇ   ‚îú‚îÄ‚îÄ ConversationHistory.tsx  # Storico conversazioni
‚îÇ   ‚îî‚îÄ‚îÄ ExportButton.tsx         # Export PDF/JSON
‚îÇ
‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ WelcomeHero.tsx          # Hero benvenuto
‚îÇ   ‚îú‚îÄ‚îÄ AssessmentCard.tsx       # Card assessment
‚îÇ   ‚îú‚îÄ‚îÄ QuickStats.tsx           # Statistiche rapide
‚îÇ   ‚îú‚îÄ‚îÄ TrialBanner.tsx          # Banner trial
‚îÇ   ‚îú‚îÄ‚îÄ MiniRadarPreview.tsx     # Mini radar chart
‚îÇ   ‚îú‚îÄ‚îÄ ExercisesCard.tsx        # Card esercizi
‚îÇ   ‚îú‚îÄ‚îÄ RecommendedExercises.tsx # Esercizi raccomandati
‚îÇ   ‚îî‚îÄ‚îÄ RecentActivity.tsx       # Attivit√† recente
‚îÇ
‚îú‚îÄ‚îÄ assessment/
‚îÇ   ‚îú‚îÄ‚îÄ QuestionCard.tsx         # Card domanda
‚îÇ   ‚îú‚îÄ‚îÄ ProgressBar.tsx          # Barra progresso
‚îÇ   ‚îî‚îÄ‚îÄ ResultsRadar.tsx         # Radar risultati
‚îÇ
‚îú‚îÄ‚îÄ charts/
‚îÇ   ‚îî‚îÄ‚îÄ LeadershipRadarChart.tsx # Radar chart Recharts
‚îÇ
‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.tsx              # Sidebar navigazione
‚îÇ   ‚îî‚îÄ‚îÄ DashboardHeader.tsx      # Header
‚îÇ
‚îú‚îÄ‚îÄ exercises/
‚îÇ   ‚îú‚îÄ‚îÄ ExercisesList.tsx        # Lista esercizi
‚îÇ   ‚îú‚îÄ‚îÄ ExerciseDetail.tsx       # Dettaglio
‚îÇ   ‚îî‚îÄ‚îÄ LockedExerciseView.tsx   # Vista bloccata
‚îÇ
‚îî‚îÄ‚îÄ challenge/
    ‚îî‚îÄ‚îÄ DiscoveryConfirmation.tsx # Quiz A/B/C
```

### Librerie (src/lib/)

```
src/lib/
‚îú‚îÄ‚îÄ ai-coach/
‚îÇ   ‚îú‚îÄ‚îÄ types.ts                 # Interfacce TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ system-prompt.ts         # Prompt Fernando completo
‚îÇ   ‚îú‚îÄ‚îÄ user-memory.ts           # Memoria personalizzazione
‚îÇ   ‚îú‚îÄ‚îÄ pattern-recognition.ts   # Pattern detection
‚îÇ   ‚îú‚îÄ‚îÄ implicit-signals.ts      # Segnali impliciti
‚îÇ   ‚îú‚îÄ‚îÄ daily-metrics.ts         # Metriche giornaliere
‚îÇ   ‚îî‚îÄ‚îÄ weekly-report.ts         # Report settimanale
‚îÇ
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îú‚îÄ‚îÄ client.ts                # Client browser
‚îÇ   ‚îú‚îÄ‚îÄ server.ts                # Client server
‚îÇ   ‚îî‚îÄ‚îÄ middleware.ts            # Auth middleware
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ exercise-recommendation.ts # Raccomandazioni esercizi
‚îÇ
‚îú‚îÄ‚îÄ challenge/
‚îÇ   ‚îú‚îÄ‚îÄ day-content.ts           # Contenuti 7 giorni (√ó3 challenge)
‚îÇ   ‚îî‚îÄ‚îÄ discovery-data.ts        # 63 domande discovery A/B/C
‚îÇ
‚îú‚îÄ‚îÄ email/
‚îÇ   ‚îî‚îÄ‚îÄ challenge-day-templates.ts # 21 template email + system emails
‚îÇ
‚îú‚îÄ‚îÄ rag.ts                       # RAG System (OpenAI embeddings)
‚îú‚îÄ‚îÄ assessment-scoring.ts        # Calcolo punteggi assessment
‚îÇ
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îú‚îÄ‚îÄ roles.ts                 # RBAC + subscription tiers
‚îÇ   ‚îî‚îÄ‚îÄ exercises.ts             # Tipi esercizi
‚îÇ
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ libri.ts                 # Dati 3 libri
```

---

## I 3 LIBRI / PERCORSI

| Libro | Slug | Colore | Prezzo |
|-------|------|--------|--------|
| Leadership Autentica | `leadership` | Oro #D4AF37 | ‚Ç¨9.90 |
| Oltre gli Ostacoli | `risolutore` | Verde #10B981 | ‚Ç¨9.90 |
| Microfelicit√† Digitale | `microfelicita` | Viola #8B5CF6 | ‚Ç¨9.90 |

---

## I 4 PILASTRI (24 Caratteristiche)

| Pilastro | Nome IT | Colore | Caratteristiche |
|----------|---------|--------|-----------------|
| ESSERE | Visione | #3B82F6 (blu) | 6 |
| SENTIRE | Relazioni | #10B981 (verde) | 6 |
| PENSARE | Adattamento | #8B5CF6 (viola) | 6 |
| AGIRE | Azione | #F59E0B (arancione) | 6 |

**Totale: 24 caratteristiche di leadership**

---

## SISTEMA CHALLENGE (Funnel 7 Giorni)

### 3 Challenge con A/B Testing

| Challenge | URL | Colore | Varianti |
|-----------|-----|--------|----------|
| Leadership Autentica | `/challenge/leadership` | Amber | A/B/C |
| Oltre gli Ostacoli | `/challenge/ostacoli` | Emerald | A/B/C |
| Microfelicit√† | `/challenge/microfelicita` | Violet | A/B/C |

### Flusso
```
1. Landing con A/B testing ‚Üí Form iscrizione
2. POST /api/challenge/subscribe ‚Üí Salva + Welcome email
3. [7 giorni] Email contenuto ‚Üí /challenge/[type]/day/[1-7]
4. Quiz discovery 3 domande A/B/C per giorno
5. Completamento ‚Üí CTA Assessment/Libro
```

### Email System (Resend)
- **21 template** contenuto (7 giorni √ó 3 challenge)
- **Reminder** (48h inattivit√†)
- **Force Advance** (72h inattivit√†)
- **Recovery** (3 giorni post-challenge)
- **Cron job:** `/api/cron/send-challenge-emails` (8:00 UTC)

---

## REGOLE TECNICHE PER FLUSSO CHALLENGE (CONTRATTO)

> **Principio guida:** L'utente √® AGENTE ATTIVO. La progressione dipende dalle SUE azioni, non dal tempo.

### 1. Semantica `current_day` (FONTE DI VERIT√Ä UNICA)

| Valore | Significato |
|--------|-------------|
| `0` | Iscritto, nessun giorno completato |
| `1` | Day 1 completato |
| `N` | Day N completato |
| `7` | Challenge completata |

```
‚ö†Ô∏è REGOLA CRITICA:
current_day = ULTIMO GIORNO COMPLETATO dall'utente
NON "prossimo da fare", NON "ultimo email inviato"
```

### 2. Tabelle Database e Ruoli

| Tabella | Ruolo | Fonte di verit√† per |
|---------|-------|---------------------|
| `challenge_subscribers` | Master | Stato iscrizione, `current_day`, status |
| `challenge_day_completions` | Tracking | Timestamp completamento + email inviate |
| `challenge_discovery_responses` | Analytics | Risposte discovery (opzionale) |
| `ab_test_events` | Analytics | Eventi A/B testing |

```
‚ö†Ô∏è REGOLA: challenge_subscribers.current_day √® l'UNICA fonte di verit√†
per determinare quali giorni sono sbloccati/completati.
```

### 3. Logica Sblocco Giorni

```typescript
// REGOLA DI SBLOCCO
const isUnlocked = (dayNumber: number, currentDay: number, isSubscribed: boolean) => {
  if (!isSubscribed) return false;           // Non iscritto ‚Üí nessun accesso
  if (dayNumber === 1) return true;          // Day 1 sempre sbloccato se iscritto
  return dayNumber <= currentDay + 1;        // Day N sbloccato se N-1 completato
};

// REGOLA DI COMPLETAMENTO
const isCompleted = (dayNumber: number, currentDay: number) => {
  return dayNumber <= currentDay;            // Completato se <= current_day
};
```

**Esempi:**
| `current_day` | Day 1 | Day 2 | Day 3 | Day 4-7 |
|---------------|-------|-------|-------|---------|
| 0 | üîì Sbloccato | üîí | üîí | üîí |
| 1 | ‚úÖ Completato | üîì Sbloccato | üîí | üîí |
| 2 | ‚úÖ | ‚úÖ Completato | üîì Sbloccato | üîí |
| 7 | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ Challenge completa |

### 4. API Contracts

#### POST `/api/challenge/subscribe`
```typescript
// INPUT
{ email, nome, challenge, variant }

// AZIONI
1. Verifica email non gi√† iscritto a questa challenge
2. Crea record in challenge_subscribers con:
   - current_day: 0  // ‚ö†Ô∏è ZERO, non 1!
   - status: 'active'
3. Invia welcome email
4. Aggiorna last_email_sent_at, last_email_type: 'welcome'

// OUTPUT
{ success: true, subscriberId }
```

#### POST `/api/challenge/complete-day`
```typescript
// INPUT
{ email, challengeType, dayNumber, responses }

// VALIDAZIONI
1. Utente deve essere iscritto (challenge_subscribers esiste)
2. dayNumber deve essere <= current_day + 1 (giorno sbloccato)
3. dayNumber non deve essere gi√† completato

// AZIONI
1. Salva completamento in challenge_day_completions
2. Aggiorna challenge_subscribers:
   - current_day: dayNumber  // ‚ö†Ô∏è IL GIORNO APPENA COMPLETATO, non dayNumber+1!
   - last_activity_at: now()
3. Se dayNumber === 7: status: 'completed', invia email finale

// OUTPUT
{ success: true, nextDay: dayNumber + 1, isCompleted: dayNumber === 7 }
```

#### Cron `/api/cron/send-challenge-emails`
```typescript
// LOGICA INVIO EMAIL
Per ogni subscriber con status: 'active':

1. SE current_day === 0 E last_email_type === 'welcome':
   ‚Üí Invia email Day 1 (contenuto, non welcome)
   ‚Üí Aggiorna last_email_type: 'day_1'

2. SE current_day >= 1 E current_day < 7:
   ‚Üí Calcola nextEmailDay = current_day + 1
   ‚Üí SE last_email_type !== 'day_' + nextEmailDay:
     ‚Üí Invia email Day nextEmailDay
     ‚Üí Aggiorna last_email_type: 'day_' + nextEmailDay

// ‚ö†Ô∏è REGOLA USER AGENCY:
Il cron invia email del giorno SUCCESSIVO solo DOPO che l'utente
ha completato il giorno corrente. L'utente controlla la progressione.
```

### 5. Autenticazione e Accesso

| Pagina | Auth Required | Iscrizione Required |
|--------|---------------|---------------------|
| `/challenge/[type]` (landing) | ‚ùå No | ‚ùå No |
| `/challenge/[type]/day/[N]` | ‚úÖ S√¨ | ‚úÖ S√¨ |
| `/challenge/[type]/complete` | ‚úÖ S√¨ | ‚úÖ S√¨ + Day 7 completato |

```typescript
// VERIFICA ACCESSO DAY PAGE
async function checkDayAccess(user, challengeType, dayNumber) {
  // 1. Verifica autenticazione
  if (!user) return { redirect: '/auth/login' };

  // 2. Verifica iscrizione
  const subscriber = await getSubscriber(user.email, challengeType);
  if (!subscriber) return { redirect: `/challenge/${challengeType}` };

  // 3. Verifica sblocco
  if (!isUnlocked(dayNumber, subscriber.current_day, true)) {
    return { locked: true, message: `Completa prima il Giorno ${dayNumber - 1}` };
  }

  return { allowed: true, isCompleted: dayNumber <= subscriber.current_day };
}
```

### 6. Mapping Challenge Types

```typescript
// Frontend URL ‚Üí Database value
const CHALLENGE_TYPE_MAP = {
  'leadership': 'leadership-autentica',
  'ostacoli': 'oltre-ostacoli',
  'microfelicita': 'microfelicita'
};

// ‚ö†Ô∏è Usare SEMPRE questo mapping per query database
```

### 7. Post-Challenge Flow (STOP ‚Üí START)

```
STOP: Challenge Day 7 completato
  ‚Üì
CTA PRIMARIA: "Acquista il Libro" (‚Ç¨24,90 fisico / ‚Ç¨9,90 PDF)
  - Il libro contiene QR code per Assessment Explorer
  ‚Üì
CTA SECONDARIA: "Hai gi√† il libro? Vai all'Assessment"
  ‚Üì
START: Assessment Explorer (72 domande Leadership)
```

### 8. Checklist Implementazione

Prima di modificare codice challenge, verifica:

- [ ] `current_day` √® interpretato come "ultimo completato"?
- [ ] Subscribe setta `current_day: 0`?
- [ ] Complete-day setta `current_day: dayNumber` (non `dayNumber + 1`)?
- [ ] Hook usa `challenge_subscribers` come fonte unica?
- [ ] Day page verifica iscrizione PRIMA di mostrare contenuto?
- [ ] Cron rispetta user agency (non forza progressione)?

---

## SISTEMA ASSESSMENT

### 3 Assessment Indipendenti (per percorso)

| Assessment | Domande | Percorso | Dimensioni |
|------------|---------|----------|------------|
| **Leadership** | 72 | Leadership Autentica | 24 caratteristiche (4 pilastri) |
| **Risolutore** | 48 | Oltre gli Ostacoli | 3 Filtri (Pattern, Segnali, Risorse) |
| **Microfelicit√†** | 47 | Microfelicit√† Digitale | 5 fasi R.A.D.A.R. |

- **Scala 1-5:** Quasi mai ‚Üí Costantemente
- **Scoring:** Direct + Inverse
- **Output:** Radar chart specifico per assessment

### Tabelle DB
- `assessment_questions_v2` (domande per assessment)
- `user_assessments_v2` (sessioni con `assessment_type`)
- `user_answers_v2` (risposte)
- `characteristic_scores` (punteggi)

---

## SISTEMA AI COACH FERNANDO

> **‚ö†Ô∏è DOCUMENTO COMPLETO:** `docs/AI_COACH_SYSTEM.md` contiene system prompt, scenari, safety protocols e compliance.

### Architettura
```
ChatWidget ‚Üí /api/ai-coach ‚Üí Claude API
                ‚Üì
            RAG System ‚Üí book_chunks (pgvector)
                ‚Üì
            User Memory ‚Üí ai_coach_user_memory
```

### System Prompt (Estratto)
```
Sei Fernando Marongiu, autore della trilogia "Rivoluzione Aurea".
Le persone hanno gi√† dentro di s√© le capacit√† di leadership.
Non devono "acquisirle" - devono RICONOSCERLE e ESPANDERLE.
```

### Esercizi nel Database
| Percorso | Fondamentali | Applicazione | Mentor | Totale |
|----------|--------------|--------------|--------|--------|
| Leadership | 4 | 52 | 8 | 64 |
| Risolutore | 4 | 24 | 3 | 31 |
| Microfelicit√† | 4 | 24 | 3 | 31 |
| **TOTALE** | **12** | **100** | **14** | **126** |

### User Memory
- `communication_style`: directive | socratic | storytelling
- `preferred_response_length`: brief | moderate | detailed
- `common_challenges[]`
- `successful_approaches[]`
- `trigger_topics[]`

### RAG (3 Libri)
- Embeddings: OpenAI `text-embedding-3-small`
- Vector search: pgvector su Supabase
- Filter per `current_path`: leadership | problemi | benessere

---

## DESIGN SYSTEM

### Colori Primari
```css
--petrol-600: #0A2540;     /* Blu Petrolio - Primary */
--gold-500: #F4B942;       /* Oro - Accent */
```

### Pilastri
```css
--pillar-being: #3B82F6;   /* Blu - Visione */
--pillar-feeling: #10B981; /* Verde - Relazioni */
--pillar-thinking: #8B5CF6;/* Viola - Adattamento */
--pillar-acting: #F59E0B;  /* Arancione - Azione */
```

### Typography
- **Display/Headings:** Stoke (serif)
- **Body:** Inter (sans-serif)

### Classi CSS Globali
```css
.btn-primary    /* bg-petrol-600 text-white */
.btn-secondary  /* bg-gold-500 text-petrol-600 */
.card           /* bg-white rounded-xl shadow-sm border */
```

---

## DATABASE (Supabase)

### Tabelle Principali
| Tabella | Righe | Descrizione |
|---------|-------|-------------|
| `profiles` | N | Profili utente (extends auth.users) |
| `characteristics` | 24 | Caratteristiche leadership |
| `assessment_questions` | 72/240 | Domande assessment |
| `exercises` | 52 | Esercizi settimanali |
| `user_exercise_progress` | N | Progresso esercizi |
| `ai_coach_conversations` | N | Storico chat AI |
| `ai_coach_user_memory` | N | Memoria personalizzazione |
| `challenge_subscribers` | N | Iscritti challenge |
| `challenge_discovery_responses` | N | Risposte quiz A/B/C |
| `book_chunks` | N | Chunks RAG con embeddings |

### RLS Attivo
Ogni utente vede solo i propri dati.

---

## SUBSCRIPTION TIERS

> Riferimento: `docs/ARCHITETTURA_DASHBOARD_VITAEOLOGY_DEFINITIVA.md`

| Tier | Prezzo | Percorsi | AI Coach | Esercizi | Extra |
|------|--------|----------|----------|----------|-------|
| **Challenge** | ‚Ç¨0 | ‚ùå | ‚ùå | ‚ùå | 7 giorni email + discovery |
| **Leader** | ‚Ç¨149/anno | 1 a scelta | ‚úÖ Illimitato | Pool percorso scelto | - |
| **Mentor** | ‚Ç¨490/anno | Tutti e 3 | ‚úÖ Illimitato | Tutti i pool | 2 sessioni 1:1/anno, Certificazione |

### Flusso Progressione
```
Challenge (‚Ç¨0) ‚Üí Leader (‚Ç¨149) ‚Üí Mentor (‚Ç¨490) ‚Üí Certificazione
```

### Paradigma Esercizi (IMPORTANTE)
```
‚ö†Ô∏è NON esiste percorso sequenziale "Settimana 1, 2, 3..."

AI Fernando:
- Ha accesso al pool completo di esercizi del percorso
- Conosce i risultati assessment dell'utente
- PROPONE l'esercizio giusto per quella persona in quel momento
- SPIEGA PERCH√â quell'esercizio √® rilevante
```

---

## VARIABILI AMBIENTE (.env.local)

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# Stripe
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PRICE_LEADER_ANNUAL=
STRIPE_PRICE_MENTOR_ANNUAL=

# AI
ANTHROPIC_API_KEY=
OPENAI_API_KEY=

# Email
RESEND_API_KEY=

# Cron
CRON_SECRET=

# App
NEXT_PUBLIC_APP_URL=
```

---

## COMANDI UTILI

```bash
npm run dev          # Avvia dev server
npm run build        # Build produzione
npm run lint         # ESLint

# Script utility
node scripts/run-sql.js sql/file.sql
node scripts/verify_ai_coach_tables.js
```

---

## SAFETY PROTOCOLS

Se l'utente menziona suicidio/autolesionismo:

```
üö® Non sono qualificato per gestire situazioni di crisi.
Contatta IMMEDIATAMENTE:
‚Ä¢ EMERGENZE: 112
‚Ä¢ Telefono Amico: 199 284 284
‚Ä¢ Samaritans Onlus: 800 86 00 22
```

---

## DOCUMENTAZIONE DETTAGLIATA

Per documentazione completa, consulta `/docs`:

### ‚ö†Ô∏è DOCUMENTI AUTORITATIVI (INSINDACABILI)

| File | Contenuto | Autorit√† su |
|------|-----------|-------------|
| `docs/ARCHITETTURA_DASHBOARD_VITAEOLOGY_DEFINITIVA.md` | **Architettura ufficiale** approvata da Fernando | Tier, flussi utente, dashboard, esercizi AI, certificazione |
| `docs/AI_COACH_SYSTEM.md` | **Fernando AI completo** - System prompt, scenari, safety | AI Coach, compliance, disclaimer, 126 esercizi |
| `docs/CUSTOMER_JOURNEY_VITAEOLOGY_COMPLETO.pdf` | **Customer Journey e Value Ladder** | 8 fasi, prezzi, funnel |

### Documenti di Riferimento

| File | Contenuto |
|------|-----------|
| `docs/PROGETTO_VITAEOLOGY_COMPLETO.md` | Documentazione tecnica master (1300+ righe) |
| `docs/DATABASE_SCHEMA.md` | Schema DB completo |
| `docs/ESERCIZI_STRUTTURA_COMPLETA.md` | Struttura 126 esercizi (12 Fond + 100 App + 14 Mentor) |
| `docs/QUICK_REFERENCE.md` | Riferimento rapido |

---

## NOTE PER CLAUDE CODE

1. **LEGGI SEMPRE** `docs/ARCHITETTURA_DASHBOARD_VITAEOLOGY_DEFINITIVA.md` per logiche di business (AUTOREVOLE)
2. **LEGGI** `/docs/PROGETTO_VITAEOLOGY_COMPLETO.md` prima di modifiche tecniche major
3. **IN CASO DI CONFLITTO** tra documenti, ARCHITETTURA_DASHBOARD prevale su altri docs
2. Usa `'use client'` per componenti interattivi
3. TypeScript strict sempre
4. Tailwind per styling, no CSS separato
5. Commenta in italiano
6. **Linguaggio validante** in tutto il codice UI/UX

---

## RIEPILOGO FUNZIONALIT√Ä

| Area | Status | File |
|------|--------|------|
| 3 Assessment (Leadership/Risolutore/Microfelicit√†) | ‚úÖ | `src/app/assessment/[type]/` |
| AI Coach Fernando + RAG | ‚úÖ | `src/lib/ai-coach/` |
| 126 Esercizi (12 Fond + 100 App + 14 Mentor) | ‚úÖ | `src/app/exercises/` |
| 3 Challenge (7 giorni) A/B | ‚úÖ | `src/app/challenge/` |
| 63 Domande Discovery | ‚úÖ | `src/lib/challenge/discovery-data.ts` |
| 21 Template Email | ‚úÖ | `src/lib/email/` |
| Cron Email Resend | ‚úÖ | `src/app/api/cron/` |
| 3 Landing Libri | ‚úÖ | `src/app/libro/` |
| Dashboard completa | ‚úÖ | `src/app/dashboard/` |
| Admin Panel (9 pagine) | ‚úÖ | `src/app/admin/` |
| Stripe Payments | ‚úÖ | `src/app/api/stripe/` |
| User Memory AI | ‚úÖ | `src/lib/ai-coach/user-memory.ts` |
| Pattern Recognition | ‚úÖ | `src/lib/ai-coach/pattern-recognition.ts` |
